<div class="container" *ngIf="!isLoading; else loading">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        {{ isEditMode ? 'Editar Libro' : 'Agregar Nuevo Libro' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Título</mat-label>
            <input matInput formControlName="title" placeholder="Título del libro">
            <mat-error *ngIf="title?.hasError('required')">
              El título es requerido
            </mat-error>
            <mat-error *ngIf="title?.hasError('minlength')">
              El título debe tener al menos 2 caracteres
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>ISBN</mat-label>
            <input matInput formControlName="isbn" placeholder="ISBN (10-13 dígitos)">
            <mat-error *ngIf="isbn?.hasError('required')">
              El ISBN es requerido
            </mat-error>
            <mat-error *ngIf="isbn?.hasError('pattern')">
              El ISBN debe contener entre 10 y 13 dígitos
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Año de publicación</mat-label>
            <input matInput type="number" formControlName="published_year" placeholder="Año">
            <mat-error *ngIf="published_year?.hasError('required')">
              El año de publicación es requerido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Copias disponibles</mat-label>
            <input matInput type="number" formControlName="available_copies" placeholder="Copias">
            <mat-error *ngIf="available_copies?.hasError('required')">
              Las copias disponibles son requeridas
            </mat-error>
            <mat-error *ngIf="available_copies?.hasError('min')">
              El número de copias no puede ser negativo
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Autores</mat-label>
            <mat-select formControlName="author_ids" multiple>
              <mat-option *ngFor="let author of authors" [value]="author.id">
                {{ author.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="author_ids?.hasError('required')">
              Debe seleccionar al menos un autor
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Géneros</mat-label>
            <mat-select formControlName="genre_ids" multiple>
              <mat-option *ngFor="let genre of genres" [value]="genre.id">
                {{ genre.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="genre_ids?.hasError('required')">
              Debe seleccionar al menos un género
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-row">
          <button mat-raised-button type="button" (click)="onCancel()">
            Cancelar
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="isLoading">
            {{ isEditMode ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<ng-template #loading>
  <div class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>